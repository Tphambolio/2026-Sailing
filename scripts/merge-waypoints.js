/**
 * Merge user-drawn waypoints into stops.json
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const STOPS_PATH = path.join(__dirname, '../src/data/stops.json');

// User's hand-drawn waypoints (exported from route editor)
const userWaypoints = {
  "1": [
    [43.8894805253013, 15.472183227539064],
    [43.872158236118786, 15.407638550306407],
    [43.90580835586092, 15.23460388233766],
    [43.87512812904008, 15.216751099134532],
    [43.843936871965695, 15.22361755371094]
  ],
  "2": [
    [43.77753930104478, 15.271682739257814],
    [43.66439469257815, 15.517501831556407],
    [43.70560803380608, 15.594406128431407],
    [43.74282465157128, 15.703582764173598],
    [43.73439091130472, 15.77362060597047],
    [43.75026520058207, 15.779800415540782],
    [43.71950494239367, 15.834732056165782],
    [43.72533572122564, 15.859622955322267]
  ],
  "3": [
    [43.72942933300513, 15.889663696289064],
    [43.73079380802074, 15.88502883923675],
    [43.71801614226201, 15.847606659060968],
    [43.680784110954875, 15.876617431640627],
    [43.52863784833001, 15.834045410156252],
    [43.463884091369046, 16.00021362304688],
    [43.463884091369046, 16.22543334960938],
    [43.469864270218416, 16.38473510742188],
    [43.48281929474004, 16.408081054687504]
  ],
  "4": [[43.402054267905655, 16.408081054687504]],
  "5": [[43.16311928246932, 16.229553222656254]],
  "6": [
    [43.016759, 16.432622],
    [43.030753001428344, 16.550903320312504],
    [43.03677585761058, 16.76651000976563],
    [42.995607893370135, 16.990356445312504],
    [42.976520698105546, 17.083740234375004]
  ],
  "7": [
    [42.94033923363183, 17.245788574218754],
    [42.88904574206037, 17.391357421875004],
    [42.78229917261048, 17.29385375976563],
    [42.73188302070198, 17.432556152343754],
    [42.712714128355564, 17.50259399414063],
    [42.70665956351041, 17.572631835937504]
  ],
  "8": [
    [42.66628070564928, 17.67562866210938],
    [42.63597933867727, 17.98049926757813],
    [42.619812573672185, 18.031311035156254]
  ],
  "9": [
    [42.44778143462245, 18.31832885742188],
    [42.37883631647602, 18.553161621093754],
    [42.40824865050679, 18.54354858398438]
  ],
  "10": [
    [42.4272579085461, 18.609294891357425],
    [42.43840732455779, 18.660964965820316],
    [42.47235014569384, 18.68156433105469],
    [42.48323834594139, 18.70456695556641],
    [42.46652544694582, 18.751602172851566],
    [42.43992754579425, 18.758125305175785]
  ],
  "11": [
    [42.47216021841415, 18.74173164367676],
    [42.48133937765146, 18.688516616821293],
    [42.449301428414955, 18.671951293945316]
  ],
  "12": [
    [42.42877840024783, 18.635559082031254],
    [42.43992754579425, 18.56449127197266],
    [42.43460661010741, 18.532905578613285],
    [42.40900913146671, 18.53599548339844],
    [42.36970554816487, 18.57101440429688],
    [42.345604091630825, 18.673667907714847],
    [42.3009285475335, 18.709373474121097],
    [42.268925435483524, 18.74954223632813],
    [42.25012237968426, 18.795890808105472],
    [42.26181142512228, 18.82095336914063],
    [42.26714700815231, 18.835029602050785],
    [42.28365904606614, 18.8470458984375]
  ],
  "13": [[42.17052852806085, 18.93081665039063]],
  "14": [
    [42.0956749167229, 19.05715942382813],
    [42.007468589586004, 19.103164672851566],
    [41.929868314485816, 19.123077392578125]
  ],
  "15": [[41.8315688643881, 19.38335730801021]],
  "16": [[41.42625319507272, 19.330444335937504]],
  "17": [[40.54928724908206, 19.231567382812504]],
  "18": [
    [40.43858586704331, 19.209594726562504],
    [40.233411907115055, 19.346923828125004],
    [40.063358664163296, 19.6051025390625]
  ],
  "19": [[39.88866516883713, 19.898986816406254]],
  "20": [
    [39.83833180263626, 19.99237060546875],
    [39.80035972468958, 19.969367980957035]
  ],
  "21": [
    [39.78954439311165, 19.95563507080078],
    [39.7752972152002, 19.96421813964844],
    [39.685260810467376, 19.92576599121094],
    [39.66834937813084, 19.900016784667972]
  ],
  "22": [
    [39.65619172865765, 19.942932128906254],
    [39.618912565294536, 20.061721801757812],
    [39.51834388059882, 20.133476257324222],
    [39.45157054162972, 20.188407897949222],
    [39.38791729112128, 20.20797729492188],
    [39.31809720257259, 20.26737213134766],
    [39.265752810382, 20.348396301269535],
    [39.26708183219306, 20.384101867675785]
  ],
  "23": [
    [39.04905220645355, 20.54855346679688],
    [38.95647211778468, 20.679016113281254],
    [38.93377552819722, 20.736351013183597]
  ],
  "24": [
    [38.93097132760883, 20.742874145507816],
    [38.88448557794294, 20.724334716796875],
    [38.849333913235476, 20.72502136230469],
    [38.83877165383055, 20.714893341064457]
  ],
  "25": [
    [38.80480136024744, 20.731372833251957],
    [38.79450007821985, 20.724849700927738],
    [38.78045047579562, 20.730342864990238],
    [38.733330660113204, 20.74630737304688]
  ],
  "26": [
    [38.59876924565357, 20.712580296419983],
    [38.540958, 20.62332]
  ],
  "27": [
    [38.39979663000095, 20.63095092773438],
    [38.32765244536364, 20.66940307617188],
    [38.29128393027484, 20.71506500244141],
    [38.26298470036054, 21.12808227539063],
    [38.29532577698144, 21.382141113281254],
    [38.29424797320529, 21.4288330078125]
  ],
  "28": [
    [38.2805681152523, 21.505639725051818],
    [38.29009, 21.625524000000002]
  ],
  "29": [
    [38.34219290233281, 21.935758058494034],
    [38.334726, 22.159212]
  ],
  "33": [
    [37.457728722097706, 23.560716836762587],
    [37.40275, 23.461452]
  ],
  "34": [[37.293720520228696, 23.271789550781254]],
  "35": [
    [37.2527403240144, 23.365859985351566],
    [37.37343130288926, 23.659057617187504],
    [37.572882155556194, 23.903503417968754],
    [37.609879943747146, 23.96804809570313]
  ],
  "37": [
    [37.593539, 24.5263],
    [37.520378, 24.7276]
  ],
  "40": [
    [37.174542956111246, 25.28160095214844],
    [37.17344871200958, 25.214309692382816],
    [37.09571688483893, 25.09757995605469]
  ],
  "41": [
    [37.06175259706909, 24.991149902343754],
    [36.97183825093165, 24.91905212402344],
    [36.8988418123063, 25.07011413574219],
    [36.90762703795211, 25.38871765136719],
    [36.91805817956114, 25.527420043945316],
    [36.81698084233672, 25.620803833007816],
    [36.848856608486905, 25.77049255371094]
  ],
  "42": [
    [36.948794297566394, 25.942153930664062],
    [36.92629228365366, 26.122055053710938],
    [36.634264115641535, 26.27243041992188],
    [36.579695207405656, 26.24496459960938],
    [36.492525490540416, 26.31912231445313],
    [36.49031738714763, 26.371307373046875],
    [36.52839834681223, 26.39190673828125]
  ],
  "43": [
    [36.56425457405503, 26.450958251953125],
    [36.58134937787054, 26.581420898437504],
    [36.739434379448674, 26.892471313476566],
    [36.89321324558287, 26.901912689208984]
  ],
  "44": [
    [36.88401445049676, 27.103271484375],
    [36.93589761453357, 27.294158935546875],
    [36.978146688562646, 27.379646301269535],
    [37.00831024540572, 27.417411804199222],
    [37.015163930679584, 27.43183135986328]
  ],
  "45": [
    [36.99377838872517, 27.45311737060547],
    [36.98445460325018, 27.47337341308594],
    [36.681636065615216, 27.30514526367188],
    [36.54163950596125, 27.61550903320313],
    [36.50411700054829, 27.822875976562504],
    [36.53612263184688, 28.171691894531254],
    [36.71907231552909, 28.348846435546875],
    [36.76501688279228, 28.307304382324222],
    [36.79419939748363, 28.26765060424805],
    [36.814404095815696, 28.262286186218265],
    [36.82560372309976, 28.265290260314945]
  ],
  "46": [
    [36.80351208910957, 28.267478942871097],
    [36.787291466820015, 28.28910827636719],
    [36.72402574695313, 28.418884277343754],
    [36.696227360541315, 28.60771179199219],
    [36.685490639009274, 28.681526184082035],
    [36.5893440354631, 28.830871582031254],
    [36.53474335181443, 29.020385742187504],
    [36.537501887278154, 29.07669067382813],
    [36.54357031890456, 29.08287048339844]
  ],
  "47": [
    [36.33946565299958, 29.058837890625004],
    [36.24205802497115, 29.267578125000004],
    [36.159498605271864, 29.432373046875004],
    [36.16836821871064, 29.52438354492188],
    [36.17917670310116, 29.58927154541016],
    [36.18167075700458, 29.600944519042972]
  ],
  "48": [
    [36.0624217151089, 29.712524414062504],
    [36.10903359678316, 29.943237304687504],
    [36.14231087352999, 30.031127929687504]
  ],
  "49": [[36.28579580846356, 30.161933898925785]],
  "50": [
    [36.16559657231973, 30.369644165039062],
    [36.15007354140755, 30.448608398437504],
    [36.240950421445, 30.528602600097656],
    [36.34914442230281, 30.577697753906254],
    [36.448351464205075, 30.535469055175785],
    [36.46464356627029, 30.536499023437504]
  ],
  "51": [[36.779592342620845, 30.67794799804688]],
  "52": [[36.78399193687664, 30.827636718750004]],
  "53": [[36.59905090311449, 31.677677045389128]],
  "54": [
    [36.140092827322654, 32.20779418945313],
    [36.04021586880114, 32.51129150390626],
    [35.985785076263035, 32.60055541992188],
    [36.01133890448606, 32.84362792968751]
  ],
  "55": [
    [35.62158189955968, 33.03863525390626],
    [35.38681081644444, 33.21304321289063]
  ],
  "56": [
    [35.45283961767315, 32.89169311523438],
    [35.31848687531321, 32.70629882812501],
    [35.12437887405888, 32.221499338603884],
    [34.69192185848015, 32.323122873760134],
    [34.55065743558245, 32.833987131572634],
    [34.51898125537333, 33.12100495383826],
    [34.65804033062336, 33.45883454368201],
    [34.72919834205246, 33.53302001953126]
  ],
  "57": [[34.42453072330726, 33.49495786675957]],
  "58": [
    [34.52466147177175, 32.72277832031251],
    [34.66145194126579, 32.48794555664063],
    [34.69646117272349, 32.44262695312501]
  ],
  "59": [[34.60382391547706, 32.71865844726563]],
  "60": [[34.24049721221427, 33.56641182101091]],
  "62": [[36.09929931833337, 32.489798637261416]],
  "63": [[36.599023328520495, 31.679053168242486]],
  "65": [[36.670308999999996, 30.574964]],
  "66": [[36.21793758955436, 29.984605923263302]],
  "67": [
    [36.183433, 29.620887],
    [36.166966, 29.602374]
  ],
  "69": [[35.77062619171316, 27.74178455296948]],
  "71": [[34.98698274323474, 27.215908028365114]],
  "72": [[35.41029331738247, 26.483814449978013]],
  "73": [[35.40062244684542, 25.898812207729527]],
  "74": [
    [35.338335663072925, 25.549383164878236],
    [35.33976283153646, 25.34445658243912]
  ],
  "75": [[35.55618102167933, 24.810069657815045]],
  "76": [[35.91879402360217, 24.397942854909868]],
  "78": [[36.33652785941609, 22.615186423395198]],
  "79": [[36.72077618782031, 22.33773847490062]],
  "80": [[36.991324, 21.973875]],
  "81": [[37.25915524324429, 21.441688901770885]],
  "83": [
    [37.91535, 20.76135],
    [38.0457, 20.627699999999997]
  ],
  "84": [
    [38.35351387989373, 20.53250674633777],
    [38.50201387989374, 20.618306746337772]
  ],
  "85": [
    [38.8181, 20.56355],
    [39.0062, 20.3771]
  ],
  "86": [[39.443786686898505, 20.10433156570846]],
  "87": [
    [39.60997512711425, 19.714211380411342],
    [39.777222, 19.590578]
  ],
  "89": [
    [39.77054750039529, 18.204345703125004],
    [39.829631721333755, 18.064270019531254],
    [39.93501296038254, 17.957153320312504],
    [39.98974718404572, 17.921447753906254]
  ],
  "90": [
    [40.198171, 17.737385],
    [40.29247506394459, 17.460776419168646]
  ],
  "91": [[39.981527819257565, 17.124382792708708]],
  "92": [[39.82035203147591, 16.94728605185492]],
  "93": [[40.07147900447805, 16.990764140043638]],
  "94": [[39.555191512380176, 16.93805755296]],
  "95": [[38.746629149878586, 17.50594582005606]],
  "96": [[38.51503719578127, 16.835518397353496]],
  "97": [[38.16095294453695, 16.200926310316618]],
  "100": [[36.45370460165979, 15.092094729411341]]
};

// Load stops
const stops = JSON.parse(fs.readFileSync(STOPS_PATH, 'utf8'));

// Merge waypoints
let updatedCount = 0;
for (const stop of stops) {
  const waypoints = userWaypoints[stop.id.toString()];
  if (waypoints) {
    stop.routeWaypoints = waypoints;
    updatedCount++;
  } else {
    // Remove any existing waypoints for stops not in user data
    delete stop.routeWaypoints;
  }
}

// Save
fs.writeFileSync(STOPS_PATH, JSON.stringify(stops, null, 2));
console.log(`Updated ${updatedCount} routes with user-drawn waypoints`);
console.log('Routes updated:', Object.keys(userWaypoints).join(', '));
